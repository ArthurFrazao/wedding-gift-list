from typing import Any, Dict, List, Union
from google.cloud import bigquery
from google.oauth2 import service_account
import os

class BigQueryClass():

    def __init__(self) -> None:
        self.project_id = os.getenv("PROJECT_ID")
        self.dataset_id = os.getenv("DATASET_ID")
        self.credentials = service_account.Credentials.from_service_account_info("ew0KICAidHlwZSI6ICJzZXJ2aWNlX2FjY291bnQiLA0KICAicHJvamVjdF9pZCI6ICJ3ZWRkaW5nLXdlYnNpdGUyMDIzIiwNCiAgInByaXZhdGVfa2V5X2lkIjogIjUyMDE4Y2RkNTU3Y2Y0NGQ2OWVlOGNmN2I3Yzc2N2YyYjc3ZDlhOWUiLA0KICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdlFJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLY3dnZ1NqQWdFQUFvSUJBUURUOWpCMG9DZzFSbklMXG5ONUhIM2pMc0kvS1AyVWhlbVNJd25tZmdVVWV2ZWVKaDR4OUNnc0grV1A4UVR1cHZad1l3bG5PTG5TWXlDZWFsXG5KZldVN2tDZlZTbnhORHN4TGtQbkcwUkF3UHgxbFlOQ01aWVpTQjlTSnluZjZIRmVxV1V6R3RvYUNta2FQWmRwXG5Qc3lzV2tCODcydC92ZDdMSFNkUVUyckpWV2drRGd6L2psRE12UVd3ckdHVGVESG9wSmtRZGdWVnBpeWdFL0VDXG5NcDYyak01bXZGbDlGQ3dBcitGTnJEOVQ5cUtadDVQWERtU0lma254SWs3ZXh5Q2hGOVVDR2x1NUI1OURLbDFtXG5xOW1RZ2JSYkpnUGZibklSM2VMWnhSdElTdytWOEFuZVJQSGlXcmtudmplK1hleSsyejlvUG5VS3BTcSsySllVXG5VUkJ1YUR2ZEFnTUJBQUVDZ2dFQUFSVXI0S3FHV0Y2d2d6dEN4dXkzTU1UUVBSWnlZMTlyanpYQk1nZEU0L2pDXG5INEw4ZG1Rcll0TlpGQlhudmQ1bzA0MmEzeDhrKzVEUjJ1dFFpT2Rtd2E2bWYrZ1plVExxNSszbzlwUTlYS0ZZXG5zdGxPNDJzcitQR0pEeGRYLzZTbjdDQ0MydG44dFp3b1B6dXJIK3gzUVBmbzJiQ1dra0IwbFByMUozL2NOZTArXG5ZZEtlbmdiSFhDaTRiWDdHMUxocUpoZHQvKzQ0SFVCWHpVTXRkN0UrbW8vWndLTWx2QlJDM21Kb3pjdjAyRDBCXG54ZDNDKzhNN3c2SWNwUGlyTS9kSmdpMzVSdi9HRitNUGd0OXpXVE42aTNIVFNHSDk4Y1hSQnozRlh1SlZPSmcwXG5RNnNKckZZa2RFUDExWEdYbDVvVUt1bUdtTVRiWWkxU0t5YXNnMnpBY1FLQmdRRHZmaEQ2clZCcXI4ODJuSVd2XG5Sdm5XZ3J0UHMxRkx6WUJLUVM1UlFQbG90d2NxV1QyckVIOUs0d25YU3E5cDFaWGEyQXY4M3BvcmVSL1lRSXk1XG5SbEhZbS90QXNlUUFDYVdtMUtWRWlyWURqWWhtb08wTmM3ZjFpWkFkZTFwbXVySll0VUg5RUFyVVZXMTNDcmN3XG4zaG1mQUhqTXVwemNBUlc5U0p5V1gwcFNkUUtCZ1FEaWtsVU5xaDZIcHJUVk8wczF1QlFtWFc1OVg0TkZQcWdFXG5SV095VWhOU1dxaFRhYjdWdXJrUnpyTmVNdXJZR2Y2VHcwRWJMRStwa1krK2llZVpwSDd5WndwcEhFVk1zWEVNXG5sNGRaUWk0Q3VpSmNXRy9MdG9BSXpJd0dBMnZ3eG9LR0xBVkFTR2FzYkdsWllJTzEzNWxwNENzT2RZVGNSTmJqXG5UVU9zOVV2R3lRS0JnUUNHWG5Ma1VvMUY3bklTTCt1SmxnYmk1ZUoyS3lPM3Bnc09ubGVBV3pZVUhHeTJ3KzhuXG5wVS9tRWxBWkxOd1NReldhM1pDTVJkQzJCM1ZvZlg3M0RJOHJPd2pUR1h2VTBaVFJiNGx5VldrZHdURUFjOVhNXG5zRnBNTnV4V3ZqalFYbnRsN2Z5aUlYZ1IvZ1Eyd0JwY0hxQzlaeVJmcVd3TXU4Y1l0ajYwMTYzNWFRS0JnRFczXG5uL2EzYUxtY3FxOExlYzlvcjA1UlJJcnhCRHg4bUhVNnhtSlcxMEhsUUpkV01PcVhkSjFtTmx5VkVkemVmTjhuXG5vZDRCYVhtNGl5NFBvQnRyUnJYTi9FZmpiZ0s2NXlTbklHM25KT1Y4bi96bzhzaUhvbDl6cjVjVlpKZ1hXSWJiXG5GUHVpcnNVZWh2T3IwRTVrandqdEh3ZzBrS1Z3cE1vTFhZbzZOaGNSQW9HQUF2eEdhV29VdEFodWVNN2U1UXNVXG5TWmtoN2VBMW9JdWhZOWd0M0tHMEE0eURqZ01zRGwwUjhQa0lOdHpVeHhkc1IxMjRMdTFNTWc3UFBjbVJpcEFrXG5GbURDd1FGbXorNjlhUEJtcHIwRkthaWhXSEFpWTVvRnVPT1g4QU9wNmVEelRaL2dlSXFxREkxYTdRSkpBRG9kXG40WDViNFVheXRrMGt5NlN6RmFmLzZnOD1cbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsDQogICJjbGllbnRfZW1haWwiOiAid2VkZGluZy13ZWJzaXRlLWJpZ3F1ZXJ5QHdlZGRpbmctd2Vic2l0ZTIwMjMuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLA0KICAiY2xpZW50X2lkIjogIjExMjM3NzEzOTk0NDEwNDk0MTgyOCIsDQogICJhdXRoX3VyaSI6ICJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvYXV0aCIsDQogICJ0b2tlbl91cmkiOiAiaHR0cHM6Ly9vYXV0aDIuZ29vZ2xlYXBpcy5jb20vdG9rZW4iLA0KICAiYXV0aF9wcm92aWRlcl94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92MS9jZXJ0cyIsDQogICJjbGllbnRfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9yb2JvdC92MS9tZXRhZGF0YS94NTA5L3dlZGRpbmctd2Vic2l0ZS1iaWdxdWVyeSU0MHdlZGRpbmctd2Vic2l0ZTIwMjMuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iDQp9")
        self.client = bigquery.Client(credentials=self.credentials)

    def execute_query(self, query:str) -> Union[None, List[Dict[str, Any]]]:
        try:
            job = self.client.query(query)
            results = job.result()
            results_dict = [dict(row) for row in results]
        except Exception as e:
            print(f"Error in executing query: {e}")
            return None
        else:
            return results_dict
